- name: Create a new primary partition with a size of 1GiB
  parted:
    device: /dev/vdb
    number: 1
    state: present
    part_end: 800MiB  
- name: Create a volume group on top of /dev/vdb1 and resize the volume group /dev/vdb1 to the maximum possible
  lvg:
    vg: vg_database
    pvs: /dev/vdb1
- name: Create a logical volume the size of 512 MB
  lvol:
    vg: vg_database
    lv: lv_mysql
    size: 512m
- name: unmount lv_mysql /mnt/mysql_backups
  mount:
    path: /mnt/mysql_backups
    src: /dev/vg_database/lv_mysql
    fstype: xfs
    state: unmounted
- name: create xfs filesystem
  filesystem:
    dev: /dev/vg_database/lv_mysql
    force: yes
    fstype: xfs
- name: mount lv_mysql /mnt/mysql_backups
  mount:
    path: /mnt/mysql_backups
    src: /dev/vg_database/lv_mysql
    fstype: xfs
    state: mounted
- name: install the latest version of mysql
  yum:
    name: mysql-community-server
    state: installed
- name: pip install PyMySQL
  pip:
    name: PyMySQL    
- name: install the latest version of firewalld
  yum:
    name: firewalld
    state: present
- name: Make sure firewalld is running and enabled
  systemd:
    enabled: yes
    state: started
    name: firewalld
- name: enable mysql on firewall
  firewalld:
    service: mysql
    permanent: yes 
    state: enabled
- name: Make sure mysqld is running and enabled
  systemd:
    enabled: yes
    state: started
    name: mysqld

- name: Create Mysql configuration file
  template: src=my.cnf.j2 dest=/etc/my.cnf
  notify:
  - restart mysqld

#- name: Touch a file, using symbolic modes to set the permissions (equivalent to 0644)
#  file:
#    path: ~/.my.cnf
#    state: touch
#    mode: u=rw,g=r,o=r

- name: Set MySQL root Password
  mysql_user:
#    check_implicit_admin: true    
#    login_host: 
#    login_unix_socket: /var/run/mysqld/mysqld.sock 
#    login_password: 
    user: root
    password: "{{ database_password }}"
  #  state: present    

- name: Configure MySQL server configuration file
  template: src=my.cnf.j2 dest=/etc/my.cnf
  tags: mysql
  notify: restart_mysql

#- meta: flush_handlers

               